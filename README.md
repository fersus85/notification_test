# Сервис уведомлений

## Содержание
- [Описание сервиса](#описание-сервиса)
- [Основные функции](#основные-функции)
- [Стек](#стек)
- [Настройки](#настройки)
- [Запуск](#запуск)
  - [Makefile](#запуск-makefile)
  - [Docker](#запуск-docker)
- [Использование](#использование)
- [Changelog](#changelog)

## Описание сервиса
Проект представляет собой сервис уведомлений, разработанный в рамках тестового задания. Он включает REST API на FastAPI для управления уведомлениями, асинхронную обработку AI-анализа текста через Celery, кэширование данных в Redis и хранение в PostgreSQL. Сервис обеспечивает создание, получение, обновление и фильтрацию уведомлений, а также интеграцию с мок-сервисом AI для анализа текста.

## Основные функции
- REST API для уведомлений: Создание, получение по ID, получение списка с фильтрацией и пагинацией, обновление статуса прочтения.
- Асинхронная обработка: Анализ текста уведомления через Celery с использованием мок-сервиса AI.
- Кэширование: Оптимизация запросов к базе данных с помощью Redis.
- Фильтрация и пагинация: Получение списка уведомлений с фильтрами по user_id, category, processing_status и пагинацией.
- Обработка ошибок и логирование: Логирование ключевых событий и ошибок для мониторинга и отладки.
## Стек
- Языки программирования: Python.
- Веб-фреймворк: FastAPI.
- Базы данных и хранилища:
- PostgreSQL (хранение уведомлений).
- Redis (кэширование и брокер для Celery).
- Асинхронная обработка: Celery с Redis.
- Инфраструктура: Docker, Docker Compose.
## Настройки
1. Клонируйте репозиторий:
```bash
  git clone https://github.com/fersus85/notification_test.git
```
2. Перейдите в директорию проекта:
```bash
  cd notification_test
```
3. Разместите в корне проекта файл .env, копируйте в него переменные из .env.example. Для безопасности нужно заменить секреты на свои значения.
```bash
POSTGRES_USER=myuser
POSTGRES_PASSWORD=mypassword
POSTGRES_DB=mydatabase
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

REDIS_HOST=redis
REDIS_PORT=6379
```

## Запуск
## Запуск Makefile
Убедитесь, что у вас установлен make, Docker и Docker Compose.
1. Запустите сервис:
```bash
make up
```
2. Выполните миграции сервис:
```bash
make db/migrate
```
## Запуск Docker
Убедитесь, что Docker и Docker Compose установлены.
1. Запустите сервис:
```bash
docker compose up -d --build
```
2. Выполните миграции сервис:
```bash
docker compose exec fastapi uv run alembic upgrade head
```
## Makefile
все команды makefile можно увидеть, вызвав
```bash
  make help
```

- FastAPI работает на http://127.0.0.1:8000.
- Используйте эндпоинты:
- POST /notifications/: Создание уведомления.
- GET /notifications/{id}: Получение уведомления по ID.
- GET /notifications/: Получение списка уведомлений с фильтрами.
- PATCH /notifications/{id}/read: Отметка уведомления как прочитанного.
- GET /notifications/{id}/status: Проверка статуса обработки.

## Changelog
### v1.0.0 (дата: 18.04.2025)
- Настроена контейнеризация с Docker Compose
- Добавлены тесты
### v0.2.0 (дата: 17.04.2025)
- Добавлен Mock AI сервис
- Настроен Celery
- Интегрирован Redis
### v0.1.0 (дата: 16.04.2025)
- Описаны контроллеры
- Миграции
- Централизованный обработчик ошибок
- Логирование
- DI
- Pydantic Schemas
- Репозиторий для работы с бд
- Сервисный слой
### v0.0.1 (дата: 15.04.2025)
- Описаны модели данных
- Подключение к бд
- Файл конфигурации
- Настроено окружение проекта
### v0.0.0 (дата: 14.04.2025)
- Первоначальная сборка проекта с базовой структурой сервисов
